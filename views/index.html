<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>DA-Taquillas</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #b5b6b8;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
      margin: 10px 0 0 0;
    }

    .form-container {
      background: #ffffff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 400px;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #333;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    input[type="text"],
    input[type="email"],
    input[type="number"] ,select{
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    .link-popup {
      color: #007bff;
      text-decoration: underline;
      cursor: pointer;
      display: inline-block;
      margin-bottom: 10px;
    }

    .checkbox-container {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }

    .checkbox-container input {
      margin-right: 10px;
    }

    button {
      width: 100%;
      padding: 12px;
      background: #15449c;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }

    button:hover {
      background: #28a745;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
    }

    .modal-content {
      background-color: #fff;
      margin: 10% auto;
      padding: 20px;
      border-radius: 8px;
      width: 80%;
      max-width: 500px;
      position: relative;
    }

    .close {
      color: #aaa;
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
    }

    .close:hover {
      color: #000;
    }
  </style>
</head>
<body>

  <form class="form-container" id="formulario" action="" method="">
    <h2>Formulario de Contacto</h2>
    <label for="delega">Representante de alumnos:</label>
    <input type="text" name="delega" id="delega" required>

    <label for="nombre">Nombre:</label>
    <input type="text" name="nombre" id="nombre" required>

    <label for="DNI">DNI:</label>
    <input type="text" name="DNI" id="DNI" required>

    <label for="telefono">Nº telefono:</label>
    <input type="text" name="telefono" id="telefono" required>

    <label for="email">email:</label>
    <input type="text" name="email" id="email" required>

    <label for="ntaquilla">Taquilla Nº:</label>
    <input type="number" name="ntaquilla" id="ntaquilla" required>

    <span class="link-popup" id="abrirPopup">Ver términos y condiciones</span>

    <div class="checkbox-container">
      <input type="checkbox" id="acepto" name="acepto" required>
      <label for="acepto">Acepto los términos</label>
    </div>

    <button type="submit" id="submit">Enviar</button>
  </form>

  <!-- Popup Modal -->
  <div id="popupModal" class="modal">
    <div class="modal-content">
      <span class="close" id="cerrarPopup">&times;</span>
      <h3>Términos y condiciones</h3>
      <p id="AcuerdoDeUso"></p>
    </div>
  </div>


  <script>
    const abrirPopup = document.getElementById('abrirPopup');
    const cerrarPopup = document.getElementById('cerrarPopup');
    const popupModal = document.getElementById('popupModal');

    abrirPopup.onclick = () => {
      popupModal.style.display = 'block';
        const ntaquilla = document.getElementById('ntaquilla').value;
        document.getElementById('AcuerdoDeUso').innerHTML=
        "Se formaliza el presente de la taquilla número " + ntaquilla +" de forma anual ,conociendo ambas partes cada uno de los puntos de la Normativa de Uso de Taquillas. Así mismo ambas partes convienen, que en caso de que se aplique, una vez pagada la señal de fianza de 5€ en concepto de donación a la Delegacion de Alumnos , se ha pagado también la cantidad de 3€ en caso de contrato semestral y 5€ en caso de contrato anual, y para quue así conste en todos los efectos que procedan firman el presente documento, siendo el mismo justificante del pago anteriormente explicado."
        ;
    };

    cerrarPopup.onclick = () => {
      popupModal.style.display = 'none';
    };

    window.onclick = (event) => {
      if (event.target == popupModal) {
        popupModal.style.display = 'none';
      }
    };
    

    const form = document.getElementById('formulario');
    var datos;
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      
      function validarFormulario(formData) {
        let nombre = formData.get('nombre');
        let delega = formData.get('delega');
        let DNI = formData.get('DNI');
        let telefono = formData.get('telefono');
        let email = formData.get('email');
        let ntaquilla = formData.get('ntaquilla');

    const errores = [];
    const regexNombre = /^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/;
    if (!nombre || !regexNombre.test(nombre)) {
        errores.push("El nombre es inválido.");
    }
    if (!delega || !regexNombre.test(delega)) {
        errores.push("La delegación es inválida.");
    }

    const regexDNI = /^\d{8}[A-Za-z]$/;
    if (!DNI || !regexDNI.test(DNI)) {
        errores.push("El DNI es inválido.");
    }

    const regexTelefono = /^\d{9}$/;
    if (!telefono || !regexTelefono.test(telefono)) {
        errores.push("El teléfono es inválido.");
    }

    const regexEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!email || !regexEmail.test(email)) {
        errores.push("El email es inválido.");
    }

    if (!ntaquilla || isNaN(ntaquilla) || parseInt(ntaquilla) < 0) {
        errores.push("La número de taquilla es inválido.");
    }

    return {
        valido: errores.length === 0,
        errores: errores
    };
}
      const resultadoComprobacion = validarFormulario(formData);
      if(resultadoComprobacion.valido)
      {
        console.log("entra");
        datos = {
        nombre: formData.get('nombre'),
        delega: formData.get('delega'),
        DNI: formData.get('DNI'),
        telefono: formData.get('telefono'),
        email: formData.get('email'),
        ntaquilla: formData.get('ntaquilla')
        
      };
      }else{
        window.alert('❌ Error al introducir datos');
      }
      

      try {
        const respuesta = await fetch('http://localhost:2000/guardar', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(datos)
        });

        if (respuesta.ok) {
          window.alert('✅ Datos guardados correctamente');
          form.reset(); 
        } else {
          const errorText = await respuesta.text();
          window.alert('❌ Error al guardar los datos: ' + errorText);
         
        }
      } catch (error) {
        window.alert('❌ Error de conexión');
      }
    });
  </script>

</body>
</html>
